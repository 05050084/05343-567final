t=imread('circles.tif');
[x,y]=meshgrid(1:256,1:256);
t2=double(t).*((x+y)/2+64)+x+y;
%figure,imshow(t2);
t3=uint8(255*mat2gray(t2));
%figure,imshow(t3);
fun=inline('im2bw(t3,graythresh(t3))');
t4=blockproc(t3,[128,32],fun);
figure,imshow(t4);